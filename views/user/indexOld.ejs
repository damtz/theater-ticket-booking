<!DOCTYPE html>
<html>
  <head>
    <title>Movie Hall Ticket Management</title>
    <!-- Add any necessary CSS styles or external CSS files -->
    <style>
      /* Add your CSS styles here */
    </style>
  </head>
  <body>
    <h1>Movie Hall Ticket Management</h1>

    <select name="hall" id="hall-select" onchange="getHallDetails(this.value)">
      <option value="select">Select Hall</option>
      <% Halls.forEach(function(hall) { %>
      <option value="<%= hall.name %>"><%= hall.name %></option>
      <% }) %>
    </select>

    <div id="movie-list"></div>

    <% if(currentUser){ %> <%= currentUser.name %>
    <a href="/logout">Logout</a> <br />
    <a href="/addHall">Add Hall</a> <br />
    <a href="/addMovie">addMovie</a>
    <% }else{ %>
    <a href="register">Register Now</a><br />
    <a href="login">Login</a>
    <% } %>

    <!-- Add any necessary JavaScript code or external JS files -->
    <script>
      function getHallDetails(hallName) {
        // Make an AJAX request to the server
        fetch('/hall-details', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ hallName: hallName }),
        })
          .then((response) => response.json())
          .then((data) => {
            const movieListElement = document.getElementById('movie-list');

            // Display the movies
            movieListElement.innerHTML = '';
            data.movies.forEach((movie) => {
              const movieElement = document.createElement('div');
              movieElement.classList.add('movie-item');
              movieElement.setAttribute('data-movie-id', movie.id);

              // Create an image element
              const imageElement = document.createElement('img');
              imageElement.src = '/images/' + movie.image; // Set the image source to the URL of the movie image
              imageElement.alt = movie.title; // Set the alt attribute to the movie title
              movieElement.appendChild(imageElement); // Append the image element to the movie element

              // Create a paragraph element for the movie title
              const titleElement = document.createElement('p');
              titleElement.textContent = 'Movie Title: ' + movie.title;
              movieElement.appendChild(titleElement); // Append the title element to the movie element

              // Append the movie element to the movie list container
              movieListElement.appendChild(movieElement);
            });
          })
          .catch((error) => {
            console.error('Error:', error);
          });
      }

      // Add an event listener to the movie list container
      const movieListContainer = document.getElementById('movie-list');
      const today = new Date();
      const year = today.getFullYear();
      const month = String(today.getMonth() + 1).padStart(2, '0');
      const day = String(today.getDate()).padStart(2, '0');
      selectedDate = `${year}-${month}-${day}`;
      movieListContainer.addEventListener('click', (event) => {
        // Check if the clicked element or its parent has the movie item class
        const movieItem = event.target.closest('.movie-item');
        if (movieItem) {
          // Retrieve the movie ID
          const movieId = movieItem.getAttribute('data-movie-id');
          // Redirect to the movie details page passing the movie ID
          window.location.href =
            '/movie-details?movieId=' + movieId + '&date=' + selectedDate;
        }
      });

      // Load the hall details and movies for the first hall in the select list
      const hallSelect = document.getElementById('hall-select');
      const firstHall = hallSelect.value;
      if (firstHall === 'select') {
        // Display all movies
        getHallDetails('');
      } else {
        // Load the details for the selected hall
        getHallDetails(firstHall);
      }
    </script>
  </body>
</html>
